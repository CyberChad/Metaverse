rl --set learning on
indifferent-selection --epsilon-greedy

sp {init*agent
    (state <s> ^type state -^name)
    -->
    (<s> ^name ready)
    }

sp {propose*move*create-output-command
    (state <s> ^type state ^name ready
    ^io.input-link.gym <gym_in>
    -^output-cmd)
-->
    (<s> ^operator <o>)
    (<s> ^name waiting)
    (<o> ^name move)
    (write (crlf)|SP:propose*move*create-output-command|(crlf))
    (write |Op: |<o>)
    (write | name: move|(crlf))
    }

# create output command
sp {apply*move*create-output-command
    (state <s> ^operator <o> ^io <io>)
    (<io> ^input-link.gym <gym_in>)
    (<gym_in> ^x <x> ^y <y>)
    (<io> ^output-link <out>)
    (<o> ^name move)
-->
    (<s> ^name busy)
    (<s> ^output-cmd <output-cmd>)
    (<output-cmd> ^move <x> <y>)
    (<out> ^cmd <cmd>)
    (<cmd> ^valx <x> ^valy <y>)
    (write (crlf)|SP:apply*move*create-output-command|(crlf))
    (write |obs.x: |<x>| obs.y: |<y>(crlf))
    }

# Remove the old commands after they are complete
sp {apply*remove*old-output-command
    (state <s> ^io.output-link <out> ^operator <o>)
    (<out> ^cmd <cmd>)
    (<o> ^name move)
-->
    (<out> ^cmd <cmd> -)
    (<s> ^output-cmd <cmd> -)
    (<s> ^name ready)
    }